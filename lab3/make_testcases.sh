#!/bin/bash

DIR="/home/osboxes/jpeg/testcases"

echo ""

if [ -d "$DIR" ]; then
    echo "Testcases directory found!"
else
    mkdir "$DIR"
    if [ -d "$DIR" ]; then
        echo "Test cases directory successfully created"
    else
        echo "Couldn't create testcases directory!. Fix it. Exiting ..."
        exit
    fi
fi

echo ""

objdump -d "${1}" | grep -Eo '\$0x[0-9a-f]+' | cut -c 2- | sort -u | while read const; do echo $const | python -c 'import sys, struct; sys.stdout.write("".join(struct.pack("<I" if len(l) <= 11 else "<Q", int(l,0)) for l in sys.stdin.readlines()))' > "$DIR"/$const; done
i=0; strings "${1}"| while read line; do echo -n "$line" > "$DIR"/string_${i} ; i=$[ $i + 1 ] ; done